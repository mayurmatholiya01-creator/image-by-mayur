<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Tile Search - Premium Edition</title>
  <style>
    * { margin:0; padding:0; box-sizing:border-box }
    body {
      font-family:-apple-system,BlinkMacSystemFont,'SF Pro Display',Roboto,sans-serif;
      background:#0d1117; color:#f0f6fc; padding:20px; min-height:100vh;
      line-height:1.6; transition:filter 0.3s ease;
    }
    
    body.modal-open { filter:blur(8px) brightness(0.6); }
    
    .app-container { 
      max-width:1200px; margin:0 auto;
      animation:fadeIn 0.6s ease-out;
    }
    @keyframes fadeIn { from{opacity:0;transform:translateY(20px)} to{opacity:1;transform:none} }

    .controls {
      display:grid; grid-template-columns:1fr 1fr; gap:20px; margin-bottom:32px;
      padding:24px; background:#161b22; border-radius:16px; border:1px solid #30363d;
    }
    .control-group { position:relative; }
    .control-label {
      display:block; color:#f0f6fc; font-size:14px; font-weight:600;
      margin-bottom:8px; text-transform:uppercase; letter-spacing:0.5px;
    }
    .control-input {
      width:100%; padding:14px 20px; background:#0d1117;
      border:2px solid #30363d; border-radius:12px; color:#f0f6fc;
      font-size:16px; outline:none; transition:all 0.3s cubic-bezier(0.4,0,0.2,1);
    }
    .control-input:focus { 
      border-color:#06d6a0; box-shadow:0 0 0 4px rgba(6,214,160,0.1);
      background:#161b22; 
    }
    .dropdown {
      appearance:none; cursor:pointer; padding-right:50px;
      background-image:url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 20 20'%3e%3cpath stroke='%238b949e' stroke-linecap='round' stroke-linejoin='round' stroke-width='1.5' d='M6 8l4 4 4-4'/%3e%3c/svg%3e");
      background-repeat:no-repeat; background-position:right 16px center; background-size:16px;
    }

    .search-suggestions {
      position:absolute; top:100%; left:0; right:0; z-index:1000;
      background:rgba(22,27,34,0.95); backdrop-filter:blur(20px);
      border:1px solid #30363d; border-radius:12px;
      max-height:300px; overflow-y:auto; display:none; margin-top:4px;
      box-shadow:0 20px 40px rgba(0,0,0,0.3);
    }
    .suggestion-item {
      padding:12px 20px; cursor:pointer; color:#f0f6fc;
      border-bottom:1px solid #21262d; transition:all 0.2s;
    }
    .suggestion-item:hover { background:rgba(6,214,160,0.1); color:#06d6a0; }
    .suggestion-item:last-child { border:none; }

    .tiles-grid { 
      display:grid; grid-template-columns:repeat(auto-fill,minmax(400px,1fr)); 
      gap:20px; margin-bottom:32px;
    }
    .tile-card {
      background:#161b22; border:1px solid #30363d; border-radius:16px;
      overflow:hidden; transition:all 0.3s cubic-bezier(0.4,0,0.2,1);
      cursor:pointer; position:relative;
    }
    .tile-card:hover { 
      transform:translateY(-4px); 
      box-shadow:0 20px 40px rgba(0,0,0,0.4);
      border-color:#06d6a0;
    }
    
    .tile-image {
      width:100%; height:280px; position:relative; overflow:hidden;
      background:linear-gradient(45deg,#1e293b,#0f1419);
    }
    .tile-image img {
      width:100%; height:100%; object-fit:cover; 
      transition:transform 0.5s cubic-bezier(0.4,0,0.2,1);
    }
    .tile-card:hover .tile-image img { transform:scale(1.05); }
    
    .tile-content {
      padding:16px 20px; display:flex; justify-content:space-between; align-items:center;
    }
    .tile-info {
      flex:1; min-width:0;
    }
    .tile-info h3 {
      font-size:1rem; font-weight:600; color:#f0f6fc; margin-bottom:2px;
      line-height:1.3; overflow:hidden; text-overflow:ellipsis; white-space:nowrap;
    }
    .tile-info p { color:#8b949e; font-size:0.85rem; }
    
    .tile-actions {
      display:flex; gap:6px; flex-shrink:0; margin-left:12px;
    }
    .action-btn {
      width:32px; height:32px; border:none; border-radius:10px; 
      cursor:pointer; display:flex; align-items:center; justify-content:center;
      transition:all 0.3s cubic-bezier(0.34,1.56,0.64,1); position:relative;
      box-shadow:inset 0 1px 0 rgba(255,255,255,0.1), 0 4px 8px rgba(0,0,0,0.2);
    }
    .action-btn:active { 
      transform:scale(0.95); 
      box-shadow:inset 0 2px 4px rgba(0,0,0,0.3); 
    }
    .download-btn { 
      background:linear-gradient(145deg,#07e6b8,#05c49a);
      background-image:url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' fill='white' viewBox='0 0 24 24'%3e%3cpath d='M19 9h-4V3H9v6H5l7 7 7-7zM5 18v2h14v-2H5z'/%3e%3c/svg%3e");
      background-size:18px; background-repeat:no-repeat; background-position:center;
    }
    .download-btn:hover { transform:scale(1.1); box-shadow:0 6px 20px rgba(6,214,160,0.4); }
    
    .whatsapp-btn { 
      background:linear-gradient(145deg,#28d367,#22b55a);
      background-image:url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' fill='white' viewBox='0 0 24 24'%3e%3cpath d='M17.472 14.382c-.297-.149-1.758-.867-2.03-.967-.273-.099-.471-.148-.67.15-.197.297-.767.966-.94 1.164-.173.199-.347.223-.644.075-.297-.15-1.255-.463-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.298-.347.446-.52.149-.174.198-.298.298-.497.099-.198.05-.371-.025-.52-.075-.149-.669-1.612-.916-2.207-.242-.579-.487-.5-.669-.51-.173-.008-.371-.01-.57-.01-.198 0-.52.074-.792.372-.272.297-1.04 1.016-1.04 2.479 0 1.462 1.065 2.875 1.213 3.074.149.198 2.096 3.2 5.077 4.487.709.306 1.262.489 1.694.625.712.227 1.36.195 1.871.118.571-.085 1.758-.719 2.006-1.413.248-.694.248-1.289.173-1.413-.074-.124-.272-.198-.57-.347m-5.421 7.403h-.004a9.87 9.87 0 01-5.031-1.378l-.361-.214-3.741.982.998-3.648-.235-.374a9.86 9.86 0 01-1.51-5.26c.001-5.45 4.436-9.884 9.888-9.884 2.64 0 5.122 1.03 6.988 2.898a9.825 9.825 0 012.893 6.994c-.003 5.45-4.437 9.884-9.885 9.884m8.413-18.297A11.815 11.815 0 0012.05 0C5.495 0 .16 5.335.157 11.892c0 2.096.547 4.142 1.588 5.945L.057 24l6.305-1.654a11.882 11.882 0 005.683 1.448h.005c6.554 0 11.89-5.335 11.893-11.893A11.821 11.821 0 0020.885 3.488'/%3e%3c/svg%3e");
      background-size:16px; background-repeat:no-repeat; background-position:center;
    }
    .whatsapp-btn:hover { transform:scale(1.1); box-shadow:0 6px 20px rgba(37,211,102,0.4); }

    .load-more {
      display:block; margin:0 auto; padding:16px 32px;
      background:linear-gradient(135deg,#06d6a0,#118ab2);
      border:none; border-radius:12px; color:#fff; font-size:16px; font-weight:600;
      cursor:pointer; transition:all 0.3s; text-transform:uppercase; letter-spacing:0.5px;
      box-shadow:0 8px 24px rgba(6,214,160,0.2);
    }
    .load-more:hover { 
      transform:translateY(-2px); 
      box-shadow:0 12px 32px rgba(6,214,160,0.3); 
    }
    .load-more:disabled { opacity:0.6; cursor:not-allowed; transform:none; }

    /* Premium Modal Styles */
    .modal-overlay {
      position:fixed; top:0; left:0; right:0; bottom:0; z-index:2000;
      background:rgba(0,0,0,0.8); backdrop-filter:blur(20px);
      display:none; align-items:center; justify-content:center; padding:20px;
      animation:backdropFadeIn 0.4s cubic-bezier(0.25,0.46,0.45,0.94);
    }
    @keyframes backdropFadeIn { 
      from { opacity:0; backdrop-filter:blur(0px); } 
      to { opacity:1; backdrop-filter:blur(20px); } 
    }
    
    .modal-content {
      background:rgba(22,27,34,0.85); backdrop-filter:blur(40px);
      border-radius:24px; max-width:85vw; max-height:85vh;
      border:1px solid rgba(48,54,61,0.5); position:relative; overflow:hidden;
      box-shadow:
        0 0 0 1px rgba(255,255,255,0.05),
        0 32px 64px rgba(0,0,0,0.5),
        inset 0 1px 0 rgba(255,255,255,0.1);
      animation:modalSlideIn 0.5s cubic-bezier(0.34,1.56,0.64,1);
      transform-origin:center center;
    }
    @keyframes modalSlideIn { 
      from { 
        opacity:0; 
        transform:scale(0.8) translateY(60px); 
        filter:blur(10px);
      } 
      to { 
        opacity:1; 
        transform:scale(1) translateY(0); 
        filter:blur(0);
      } 
    }
    
    .modal-header {
      padding:20px 24px; border-bottom:1px solid rgba(48,54,61,0.5);
      display:flex; justify-content:center; align-items:center; position:relative;
      background:linear-gradient(180deg, rgba(22,27,34,0.95) 0%, rgba(22,27,34,0.85) 100%);
    }
    .modal-title-container {
      text-align:center; flex:1;
    }
    .modal-title { 
      font-size:1.1rem; font-weight:600; color:#f0f6fc; 
      margin-bottom:4px; line-height:1.3;
    }
    .modal-subtitle { 
      color:#8b949e; font-size:0.9rem;
    }
    
    .close-btn {
      position:absolute; right:20px; top:50%; transform:translateY(-50%);
      width:36px; height:36px; border:none; 
      background:rgba(33,38,45,0.8); backdrop-filter:blur(10px);
      color:#8b949e; border-radius:18px; cursor:pointer; 
      display:flex; align-items:center; justify-content:center;
      transition:all 0.3s; font-size:18px; font-weight:300;
      border:1px solid rgba(48,54,61,0.5);
    }
    .close-btn:hover { 
      background:rgba(239,68,68,0.9); 
      color:#fff; transform:translateY(-50%) scale(1.1); 
    }
    
    .modal-image-container {
      position:relative; overflow:hidden; background:#000;
    }
    .modal-image {
      max-width:800px; max-height:600px; width:100%; height:auto;
      display:block; margin:0 auto; transition:transform 0.3s ease;
      cursor:zoom-in;
    }
    .modal-image:hover { transform:scale(1.02); }
    .modal-image.zoomed { 
      transform:scale(1.5); cursor:zoom-out; 
      transition:transform 0.4s cubic-bezier(0.25,0.46,0.45,0.94);
    }
    
    .modal-footer {
      background:linear-gradient(0deg, rgba(22,27,34,0.95) 0%, rgba(22,27,34,0.85) 100%);
      padding:16px 24px; border-top:1px solid rgba(48,54,61,0.5);
      display:flex; justify-content:center; align-items:center; gap:16px;
    }
    
    .modal-action-btn {
      width:48px; height:48px; border:none; border-radius:16px;
      cursor:pointer; display:flex; align-items:center; justify-content:center;
      transition:all 0.3s cubic-bezier(0.34,1.56,0.64,1); position:relative;
      box-shadow:
        inset 0 1px 0 rgba(255,255,255,0.2),
        0 8px 16px rgba(0,0,0,0.3);
    }
    .modal-action-btn:active { 
      transform:scale(0.9); 
      box-shadow:inset 0 4px 8px rgba(0,0,0,0.3); 
    }
    .modal-download-btn {
      background:linear-gradient(145deg,#07e6b8,#05c49a);
      background-image:url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' fill='white' viewBox='0 0 24 24'%3e%3cpath d='M19 9h-4V3H9v6H5l7 7 7-7zM5 18v2h14v-2H5z'/%3e%3c/svg%3e");
      background-size:24px; background-repeat:no-repeat; background-position:center;
    }
    .modal-download-btn:hover { 
      transform:scale(1.15); 
      box-shadow:0 12px 32px rgba(6,214,160,0.5); 
    }
    
    .modal-whatsapp-btn {
      background:linear-gradient(145deg,#28d367,#22b55a);
      background-image:url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' fill='white' viewBox='0 0 24 24'%3e%3cpath d='M17.472 14.382c-.297-.149-1.758-.867-2.03-.967-.273-.099-.471-.148-.67.15-.197.297-.767.966-.94 1.164-.173.199-.347.223-.644.075-.297-.15-1.255-.463-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.298-.347.446-.52.149-.174.198-.298.298-.497.099-.198.05-.371-.025-.52-.075-.149-.669-1.612-.916-2.207-.242-.579-.487-.5-.669-.51-.173-.008-.371-.01-.57-.01-.198 0-.52.074-.792.372-.272.297-1.04 1.016-1.04 2.479 0 1.462 1.065 2.875 1.213 3.074.149.198 2.096 3.2 5.077 4.487.709.306 1.262.489 1.694.625.712.227 1.36.195 1.871.118.571-.085 1.758-.719 2.006-1.413.248-.694.248-1.289.173-1.413-.074-.124-.272-.198-.57-.347m-5.421 7.403h-.004a9.87 9.87 0 01-5.031-1.378l-.361-.214-3.741.982.998-3.648-.235-.374a9.86 9.86 0 01-1.51-5.26c.001-5.45 4.436-9.884 9.888-9.884 2.64 0 5.122 1.03 6.988 2.898a9.825 9.825 0 012.893 6.994c-.003 5.45-4.437 9.884-9.885 9.884m8.413-18.297A11.815 11.815 0 0012.05 0C5.495 0 .16 5.335.157 11.892c0 2.096.547 4.142 1.588 5.945L.057 24l6.305-1.654a11.882 11.882 0 005.683 1.448h.005c6.554 0 11.89-5.335 11.893-11.893A11.821 11.821 0 0020.885 3.488'/%3e%3c/svg%3e");
      background-size:20px; background-repeat:no-repeat; background-position:center;
    }
    .modal-whatsapp-btn:hover { 
      transform:scale(1.15); 
      box-shadow:0 12px 32px rgba(37,211,102,0.5); 
    }

    .empty-state {
      text-align:center; padding:80px 20px; color:#8b949e;
    }
    .empty-state h3 { font-size:1.5rem; margin-bottom:12px; color:#f0f6fc; }

    /* Touch gestures */
    .modal-content.swipe-down {
      animation:swipeDown 0.3s cubic-bezier(0.25,0.46,0.45,0.94) forwards;
    }
    @keyframes swipeDown {
      to { 
        opacity:0; 
        transform:translateY(100px) scale(0.9); 
      }
    }

    @media(max-width:768px){
      .controls { grid-template-columns:1fr; }
      .tiles-grid { grid-template-columns:1fr; }
      .modal-content { 
        max-width:95vw; max-height:95vh; border-radius:20px;
      }
      .modal-header { padding:16px 20px; }
      .modal-footer { padding:12px 20px; }
      .action-btn { width:28px; height:28px; }
      .modal-action-btn { width:44px; height:44px; }
      .app-container { padding:16px; }
    }
  </style>
</head>
<body>
  <div class="app-container">
    <div class="controls">
      <div class="control-group">
        <label class="control-label">Filter by Size</label>
        <select id="sizeFilter" class="control-input dropdown">
          <option value="">All Sizes</option>
        </select>
      </div>
      <div class="control-group">
        <label class="control-label">Search Designs</label>
        <input id="searchInput" class="control-input" type="text" 
               placeholder="Type design name..." autocomplete="off" />
        <div id="searchSuggestions" class="search-suggestions"></div>
      </div>
    </div>

    <div id="tilesGrid" class="tiles-grid"></div>
    
    <button id="loadMoreBtn" class="load-more" style="display:none">
      Load More Designs
    </button>

    <div class="empty-state" id="emptyState" style="display:none">
      <h3>No tiles found</h3>
      <p>Try adjusting your search or filter criteria</p>
    </div>
  </div>

  <!-- Premium Modal -->
  <div id="modalOverlay" class="modal-overlay">
    <div id="modalContent" class="modal-content">
      <div class="modal-header">
        <div class="modal-title-container">
          <div class="modal-title" id="modalTitle"></div>
          <div class="modal-subtitle" id="modalSubtitle"></div>
        </div>
        <button class="close-btn" onclick="closeModal()">✕</button>
      </div>
      <div class="modal-image-container">
        <img id="modalImage" class="modal-image" alt="" />
      </div>
      <div class="modal-footer">
        <button class="modal-action-btn modal-download-btn" id="modalDownload" title="Download"></button>
        <button class="modal-action-btn modal-whatsapp-btn" id="modalWhatsapp" title="Share on WhatsApp"></button>
      </div>
    </div>
  </div>

  <script>
    const app = {
      data: [],
      filteredData: [],
      displayedCount: 5,
      loadIncrement: 10,
      
      elements: {
        sizeFilter: document.getElementById('sizeFilter'),
        searchInput: document.getElementById('searchInput'),
        suggestions: document.getElementById('searchSuggestions'),
        tilesGrid: document.getElementById('tilesGrid'),
        loadMoreBtn: document.getElementById('loadMoreBtn'),
        emptyState: document.getElementById('emptyState'),
        modal: document.getElementById('modalOverlay'),
        modalContent: document.getElementById('modalContent'),
        modalTitle: document.getElementById('modalTitle'),
        modalSubtitle: document.getElementById('modalSubtitle'),
        modalImage: document.getElementById('modalImage'),
        modalDownload: document.getElementById('modalDownload'),
        modalWhatsapp: document.getElementById('modalWhatsapp')
      }
    };

    // Utility Functions
    function getImageUrl(driveUrl) {
      const id = driveUrl?.match(/[-\w]{25,}/)?.[0];
      return id ? `https://drive.google.com/thumbnail?id=${id}&sz=w400` : '';
    }

    function getDownloadUrl(driveUrl) {
      const id = driveUrl?.match(/[-\w]{25,}/)?.[0];
      return id ? `https://drive.google.com/uc?export=download&id=${id}` : driveUrl;
    }

    function getFullImageUrl(driveUrl) {
      const id = driveUrl?.match(/[-\w]{25,}/)?.[0];
      return id ? `https://lh3.googleusercontent.com/d/${id}=w1200` : '';
    }

    // Touch gesture handling
    let touchStartY = 0;
    let touchEndY = 0;

    function handleTouchStart(e) {
      touchStartY = e.changedTouches[0].screenY;
    }

    function handleTouchEnd(e) {
      touchEndY = e.changedTouches[0].screenY;
      handleSwipe();
    }

    function handleSwipe() {
      if (touchEndY - touchStartY > 100) {
        // Swipe down detected
        app.elements.modalContent.classList.add('swipe-down');
        setTimeout(closeModal, 300);
      }
    }

    // Fuzzy Search Implementation
    function fuzzySearch(query, text) {
      query = query.toLowerCase();
      text = text.toLowerCase();
      let queryIndex = 0;
      for (let i = 0; i < text.length && queryIndex < query.length; i++) {
        if (text[i] === query[queryIndex]) queryIndex++;
      }
      return queryIndex === query.length;
    }

    function getSuggestions(query) {
      if (!query.trim()) return [];
      return app.data
        .filter(tile => fuzzySearch(query, tile.design_name))
        .map(tile => tile.design_name)
        .filter((name, index, arr) => arr.indexOf(name) === index)
        .slice(0, 8);
    }

    // UI Functions
    function populateSizeFilter() {
      const sizes = [...new Set(app.data.map(t => t.dimensions))]
        .filter(Boolean)
        .sort((a, b) => {
          const aNum = parseInt(a.match(/\d+/)?.[0] || '0');
          const bNum = parseInt(b.match(/\d+/)?.[0] || '0');
          return aNum - bNum;
        });
      
      app.elements.sizeFilter.innerHTML = '<option value="">All Sizes</option>';
      sizes.forEach(size => {
        const opt = document.createElement('option');
        opt.value = size;
        opt.textContent = size;
        app.elements.sizeFilter.appendChild(opt);
      });
    }

    function showSuggestions(suggestions) {
      const container = app.elements.suggestions;
      if (!suggestions.length) {
        container.style.display = 'none';
        return;
      }
      
      container.innerHTML = suggestions
        .map(name => `<div class="suggestion-item" onclick="selectSuggestion('${name}')">${name}</div>`)
        .join('');
      container.style.display = 'block';
    }

    function selectSuggestion(name) {
      app.elements.searchInput.value = name;
      app.elements.suggestions.style.display = 'none';
      applyFilters();
    }

    function renderTiles() {
      const tilesToShow = app.filteredData.slice(0, app.displayedCount);
      
      if (!tilesToShow.length) {
        app.elements.tilesGrid.innerHTML = '';
        app.elements.loadMoreBtn.style.display = 'none';
        app.elements.emptyState.style.display = 'block';
        return;
      }

      app.elements.emptyState.style.display = 'none';
      app.elements.tilesGrid.innerHTML = tilesToShow.map(tile => {
        const imageUrl = getImageUrl(tile.url);
        const downloadUrl = getDownloadUrl(tile.url);
        const fullUrl = getFullImageUrl(tile.url);
        
        return `
          <div class="tile-card" onclick="openModal('${tile.design_name}', '${tile.dimensions}', '${fullUrl}', '${downloadUrl}')">
            <div class="tile-image">
              ${imageUrl ? `<img src="${imageUrl}" alt="${tile.design_name}" loading="lazy" />` : 
                '<div style="display:flex;align-items:center;justify-content:center;height:100%;color:#8b949e">No Image</div>'}
            </div>
            <div class="tile-content">
              <div class="tile-info">
                <h3>${tile.design_name}</h3>
                <p>${tile.dimensions}</p>
              </div>
              <div class="tile-actions">
                <button class="action-btn download-btn" onclick="event.stopPropagation();window.open('${downloadUrl}','_blank')" 
                        title="Download"></button>
                <button class="action-btn whatsapp-btn" onclick="event.stopPropagation();shareToWhatsApp('${tile.design_name}','${fullUrl}')" 
                        title="Share on WhatsApp"></button>
              </div>
            </div>
          </div>`;
      }).join('');

      // Show/hide load more button
      app.elements.loadMoreBtn.style.display = 
        app.displayedCount < app.filteredData.length ? 'block' : 'none';
    }

    function applyFilters() {
      const searchTerm = app.elements.searchInput.value.toLowerCase().trim();
      const selectedSize = app.elements.sizeFilter.value;
      
      app.filteredData = app.data.filter(tile => {
        const matchesSearch = !searchTerm || tile.design_name.toLowerCase().includes(searchTerm);
        const matchesSize = !selectedSize || tile.dimensions === selectedSize;
        return matchesSearch && matchesSize;
      });
      
      app.displayedCount = 5;
      renderTiles();
    }

    function loadMore() {
      app.displayedCount += app.loadIncrement;
      renderTiles();
    }

    // Premium Modal Functions
    function openModal(title, size, imageUrl, downloadUrl) {
      app.elements.modalTitle.textContent = title;
      app.elements.modalSubtitle.textContent = size;
      app.elements.modalImage.src = imageUrl;
      
      // Reset modal state
      app.elements.modalContent.classList.remove('swipe-down');
      app.elements.modalImage.classList.remove('zoomed');
      
      // Set modal button actions
      app.elements.modalDownload.onclick = () => window.open(downloadUrl, '_blank');
      app.elements.modalWhatsapp.onclick = () => shareToWhatsApp(title, imageUrl);
      
      // Add touch gesture listeners
      app.elements.modalContent.addEventListener('touchstart', handleTouchStart, false);
      app.elements.modalContent.addEventListener('touchend', handleTouchEnd, false);
      
      document.body.classList.add('modal-open');
      app.elements.modal.style.display = 'flex';
      document.body.style.overflow = 'hidden';
    }

    function closeModal() {
      document.body.classList.remove('modal-open');
      app.elements.modal.style.display = 'none';
      document.body.style.overflow = 'auto';
      
      // Remove touch gesture listeners
      app.elements.modalContent.removeEventListener('touchstart', handleTouchStart);
      app.elements.modalContent.removeEventListener('touchend', handleTouchEnd);
    }

    // Image zoom functionality
    app.elements.modalImage.addEventListener('click', function() {
      this.classList.toggle('zoomed');
    });

    // Share Function
    async function shareToWhatsApp(name, url) {
      try {
        const response = await fetch(url);
        const blob = await response.blob();
        const file = new File([blob], `${name}.jpg`, { type: 'image/jpeg' });
        
        if (navigator.share && navigator.canShare({ files: [file] })) {
          await navigator.share({ files: [file] });
        } else {
          window.open(`https://wa.me/?text=${encodeURIComponent(url)}`, '_blank');
        }
      } catch (error) {
        console.error('Share failed:', error);
        window.open(url, '_blank');
      }
    }

    // Event Listeners
    app.elements.searchInput.addEventListener('input', (e) => {
      const query = e.target.value;
      if (query.length > 1) {
        const suggestions = getSuggestions(query);
        showSuggestions(suggestions);
      } else {
        app.elements.suggestions.style.display = 'none';
      }
      applyFilters();
    });

    app.elements.sizeFilter.addEventListener('change', () => {
      app.elements.searchInput.value = '';
      app.elements.suggestions.style.display = 'none';
      applyFilters();
    });

    app.elements.loadMoreBtn.addEventListener('click', loadMore);

    // Close suggestions when clicking outside
    document.addEventListener('click', (e) => {
      if (!e.target.closest('.control-group')) {
        app.elements.suggestions.style.display = 'none';
      }
    });

    // Close modal on overlay click
    app.elements.modal.addEventListener('click', (e) => {
      if (e.target === app.elements.modal) closeModal();
    });

    // Keyboard navigation
    document.addEventListener('keydown', (e) => {
      if (e.key === 'Escape') closeModal();
    });

    // Data Loading
    async function loadData() {
      try {
        const csvUrl = 'https://docs.google.com/spreadsheets/d/1oHpJw-_zLdf_jt2SL5l7Hpiu8nSK9gvXfLEVvLlz5cM/export?format=csv&gid=622851011';
        const response = await fetch(csvUrl);
        const text = await response.text();
        
        app.data = text.trim().split('\n').slice(1)
          .filter(line => line.trim())
          .map(line => {
            const cols = line.split(',');
            return {
              filename: cols[0] || '',
              dimensions: cols[1] || '',
              design_name: cols[2] || '',
              url: cols[3] || ''
            };
          })
          .filter(tile => tile.design_name && tile.url);

        app.filteredData = [...app.data];
        populateSizeFilter();
        renderTiles();
      } catch (error) {
        console.error('Failed to load data:', error);
        app.elements.emptyState.style.display = 'block';
        app.elements.emptyState.innerHTML = '<h3>Failed to load tiles</h3><p>Please check your connection and try again</p>';
      }
    }

    // Initialize
    loadData();
  </script>
</body>
</html>
