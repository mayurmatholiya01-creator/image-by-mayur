<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Tile Search</title>
  <style>
    * { margin:0; padding:0; box-sizing:border-box }
    body {
      font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',sans-serif;
      background:#0f1f1f; color:#fff; padding:20px; min-height:100vh;
    }
    .container { max-width:900px; margin:0 auto }
    .main-card {
      background:linear-gradient(135deg,#1a3333,#0d2626);
      border-radius:16px; padding:32px; border:1px solid #2d4a4a;
      box-shadow:0 20px 60px rgba(0,0,0,0.4); position:relative;
    }
    .main-card::before {
      content:''; position:absolute;top:0;left:0;right:0;height:2px;
      background:linear-gradient(90deg,#10b981,#059669,#047857);
    }
    .filter-section,.search-section { margin-bottom:24px }
    .filter-label {
      color:#d1d5db;font-size:14px;font-weight:600;
      text-transform:uppercase;letter-spacing:0.5px;
      margin-bottom:8px;display:block;
    }
    .filter-dropdown,.search-input {
      width:100%;padding:16px 20px;background:#1a3333;
      border:1px solid #2d4a4a;border-radius:12px;color:#fff;
      font-size:16px;outline:none;transition:0.3s;
    }
    .filter-dropdown { 
      appearance:none;padding-right:50px;
      background-image:url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 20 20'%3e%3cpath stroke='%236b7280' stroke-linecap='round' stroke-linejoin='round' stroke-width='1.5' d='M6 8l4 4 4-4'/%3e%3c/svg%3e");
      background-repeat:no-repeat;background-position:right 16px center;background-size:16px;
    }
    .filter-dropdown:focus,.search-input:focus {
      border-color:#10b981;box-shadow:0 0 0 3px rgba(16,185,129,0.1);
    }
    .results-container {
      background:#1a3333;border:1px solid #2d4a4a;
      border-radius:12px;padding:24px;color:#6b7280;
    }
    .tile {
      display:flex;align-items:center;
      background:#152a2a;border:1px solid #2d4a4a;
      border-radius:12px;margin-bottom:16px;overflow:hidden;
    }
    .tile-image {
      width:100px;height:100px;background:#0d1f1f;
      display:flex;align-items:center;justify-content:center;
      border-right:1px solid #2d4a4a;color:#6b7280;
      font-size:12px;text-align:center;
    }
    .tile-image img {
      width:100%;height:100%;object-fit:cover;
    }
    .tile-info { flex:1;padding:16px }
    .tile-info strong { color:#fff;display:block;margin-bottom:4px }
    .tile-info small { color:#9ca3af }
    .tile-buttons { 
      display:flex;gap:8px;padding:16px;flex-direction:column;
    }
    .tile-buttons button {
      border:none;color:#fff;padding:10px 16px;border-radius:8px;
      cursor:pointer;font-size:14px;font-weight:500;
      transition:all 0.2s;
    }
    .download-btn { background:#10b981 }
    .download-btn:hover { background:#059669 }
    .share-btn { background:#374151 }
    .share-btn:hover { background:#4b5563 }
    @media(max-width:640px){
      .tile { flex-direction:column;text-align:center }
      .tile-image { width:100%;height:200px;border:none }
      .tile-buttons { flex-direction:row;justify-content:center }
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="main-card">
      <div class="filter-section">
        <label class="filter-label">Filter by Size</label>
        <select id="sizeFilter" class="filter-dropdown">
          <option value="">All Sizes</option>
        </select>
      </div>
      <div class="search-section">
        <input id="searchInput" class="search-input" type="text"
               placeholder="Search tiles by design name..." />
      </div>
      <div id="resultsContainer" class="results-container">
        <div style="text-align:center;padding:40px;color:#6b7280;">
          Loading tiles...
        </div>
      </div>
    </div>
  </div>

  <script>
    const sizeFilter = document.getElementById('sizeFilter');
    const searchInput = document.getElementById('searchInput');
    const resultsContainer = document.getElementById('resultsContainer');
    let tilesData = [];

    function getImageUrl(driveUrl) {
      if (!driveUrl || !driveUrl.includes('drive.google.com')) return '';
      const fileId = driveUrl.match(/[-\w]{25,}/);
      return fileId ? `https://drive.google.com/thumbnail?id=${fileId[0]}&sz=w200` : '';
    }

    function getDownloadUrl(driveUrl) {
      if (!driveUrl || !driveUrl.includes('drive.google.com')) return driveUrl;
      const fileId = driveUrl.match(/[-\w]{25,}/);
      return fileId ? `https://drive.google.com/uc?export=download&id=${fileId[0]}` : driveUrl;
    }

    function populateSizeFilter() {
      const sizes = [...new Set(tilesData.map(t => t.dimensions))].sort();
      sizeFilter.innerHTML = '<option value="">All Sizes</option>';
      sizes.forEach(size => {
        const opt = document.createElement('option');
        opt.value = size;
        opt.textContent = size;
        sizeFilter.appendChild(opt);
      });
    }

    function displayTiles(tiles) {
      if (!tiles.length) {
        resultsContainer.innerHTML = '<div style="text-align:center;padding:40px;color:#6b7280;">No tiles found</div>';
        return;
      }

      resultsContainer.innerHTML = tiles.map(tile => {
        const imageUrl = getImageUrl(tile.url);
        const downloadUrl = getDownloadUrl(tile.url);
        
        return `
          <div class="tile">
            <div class="tile-image">
              ${imageUrl ? `<img src="${imageUrl}" alt="${tile.design_name}" loading="lazy" />` : 'No Image'}
            </div>
            <div class="tile-info">
              <strong>${tile.design_name}</strong>
              <small>${tile.dimensions}</small>
            </div>
            <div class="tile-buttons">
              <button class="download-btn" onclick="window.open('${downloadUrl}', '_blank')">
                Download
              </button>
              <button class="share-btn" onclick="shareFile('${tile.design_name}', '${downloadUrl}')">
                Share
              </button>
            </div>
          </div>
        `;
      }).join('');
    }

    function shareFile(name, url) {
      if (navigator.share) {
        navigator.share({
          title: name,
          text: `Check out this tile: ${name}`,
          url: url
        });
      } else {
        navigator.clipboard.writeText(url).then(() => {
          alert('Link copied to clipboard!');
        });
      }
    }

    function applyFilters() {
      const searchTerm = searchInput.value.toLowerCase().trim();
      const selectedSize = sizeFilter.value;
      
      let filtered = tilesData;
      
      if (searchTerm) {
        filtered = filtered.filter(tile => 
          tile.design_name.toLowerCase().includes(searchTerm)
        );
      }
      
      if (selectedSize) {
        filtered = filtered.filter(tile => tile.dimensions === selectedSize);
      }
      
      displayTiles(filtered);
    }

    searchInput.addEventListener('input', applyFilters);
    sizeFilter.addEventListener('change', applyFilters);

    async function loadData() {
      try {
        const csvUrl = 'https://docs.google.com/spreadsheets/d/1oHpJw-_zLdf_jt2SL5l7Hpiu8nSK9gvXfLEVvLlz5cM/export?format=csv&gid=622851011';
        const response = await fetch(csvUrl);
        const csvText = await response.text();
        
        const lines = csvText.trim().split('\n');
        const [header, ...rows] = lines;
        
        tilesData = [];
        rows.forEach((line, index) => {
          if (line.trim()) {
            const columns = line.split(',');
            if (columns.length >= 5) {
              tilesData.push({
                filename: columns[0] || '',
                dimensions: columns[1] || '',
                design_name: columns[2] || `Design ${index + 1}`,
                url: columns[3] || '',
                uploaded_at: columns[4] || ''
              });
            }
          }
        });

        populateSizeFilter();
        applyFilters();
        
      } catch (error) {
        console.error('Error loading data:', error);
        resultsContainer.innerHTML = '<div style="text-align:center;padding:40px;color:#ef4444;">Failed to load tiles. Please try again.</div>';
      }
    }

    loadData();
  </script>
</body>
</html>
